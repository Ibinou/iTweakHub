<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="css/featured.css" keep>
  <link rel="stylesheet" href="css/navbar.css" keep>
  <link rel="stylesheet" href="css/styles.css" keep>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#121212">
  <meta name="viewport"content="initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>For You | iTweakHub</title>
  <script src="/js/index.js"></script>
  <script src="https://kit.fontawesome.com/a5ae6c00ff.js" crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
</head>

<body style="opacity: 0;">

                                                                              
<div class="sidebar">
  <a href="index.html">Home</a>
  <a class="active" href="appsmanager.html">Apps Manager</a>
  <a href="search.html">Search</a>
</div>

  <div class="content">

    <div class="toptitle">	
    <a style="text-decoration: none" href="appsmanager.html"><h1 style="font-family:helvetica;font-size:21px;margin-left: 16px;color: var(--accent-color);"><i class="fa-solid fa-angle-left" style="color: var(--accent-color);margin-right: 5px;"></i>Back</h1></a>
    <h1 id="repoName" style="font-family:helvetica;font-size:28px;color: #fff;margin-top: 0px;margin-left: 16px;margin-bottom: 10px;">For You</h1>
    </div>
    
<div id="appDockContainer">
  <!-- App Dock will be appended here dynamically -->
</div>
	  
<div class="gradient-div"></div>
  <div class="hidecolor">	
  <input type="color" id="color-picker">
  <button id="reset-button">Reset</button>
	</div> 
   </div>
  

<script>
    // Fonction pour enregistrer la couleur dans localStorage
    function setAccentColor(color) {
      localStorage.setItem('accentColor', color);
    }

    // Fonction pour récupérer la couleur de localStorage
    function getAccentColor() {
      return localStorage.getItem('accentColor');
    }

    // Fonction pour appliquer la couleur à l'élément souhaité
    function applyAccentColor() {
      const accentColor = getAccentColor() || '#7163FF'; // Couleur de base si aucun enregistrement trouvé
      document.documentElement.style.setProperty('--accent-color', accentColor);
    }

    // Réinitialiser la couleur à celle par défaut
    function resetAccentColor() {
      setAccentColor('#7163FF'); // Couleur de base
      applyAccentColor();
    }

    // Écouteur d'événement pour le changement de couleur
    const colorPicker = document.getElementById('color-picker');
    colorPicker.addEventListener('change', function() {
      const color = this.value;
      setAccentColor(color);
      applyAccentColor();
    });

    // Écouteur d'événement pour le bouton de réinitialisation
    const resetButton = document.getElementById('reset-button');
    resetButton.addEventListener('click', function() {
      resetAccentColor();
    });

    // Appliquer la couleur lors du chargement de la page
    applyAccentColor();
  </script>

<script>
async function getAppInfo(appName) {
  const repoURLs = JSON.parse(localStorage.getItem("repoURLs")) || [];

  async function searchRepoInfo(repoURL) {
    try {
      const response = await fetch(`${repoURL}.json`);
      if (response.ok) {
        const repoInfo = await response.json();
        const category = repoInfo.categories.find(cat => cat.apps.includes(appName));
        if (category) {
          return { name: appName, category: category.name, iconURL: repoInfo.iconURL };
        }
      }
    } catch (error) {
      console.error(`Error fetching app info from ${repoURL}: ${error.message}`);
    }
    return null;
  }

  // Recherchez dans chaque repoURL
  for (const repoURL of repoURLs) {
    const appInfo = await searchRepoInfo(repoURL);
    if (appInfo) {
      return appInfo;
    }
  }

  // Si les infos n'ont pas été trouvées dans les repoURLs, recherchez dans le fichier foryou.json
  try {
    const response = await fetch("foryou.json");
    if (response.ok) {
      const forYouData = await response.json();
      const category = forYouData.categories.find(cat => cat.apps.includes(appName));
      if (category) {
        return { name: appName, category: category.name, iconURL: "path/to/default/icon.png" }; // Remplacez "path/to/default/icon.png" par l'URL par défaut de l'icône
      }
    }
  } catch (error) {
    console.error(`Error fetching app info from foryou.json: ${error.message}`);
  }

  return null;
}

async function processRecentApps() {
  const recentApps = JSON.parse(localStorage.getItem("recentApps")) || [];
  const dockContainer = document.getElementById("dockContainer"); // Ajoutez un ID à votre conteneur de docks dans le HTML

  const appInfoPromises = recentApps.map(appName => getAppInfo(appName));

  try {
    const appInfos = await Promise.all(appInfoPromises);

    // Créer des divs dock pour chaque application
    appInfos.forEach(appInfo => {
      const dockDiv = document.createElement("div");
      dockDiv.className = "dock";
      dockDiv.style.margin = "5px";

      const appCellLeftDiv = document.createElement("div");
      appCellLeftDiv.className = "app_cell_left";

      const appIconImg = document.createElement("img");
      appIconImg.src = appInfo.iconURL; // Utilisez l'URL de l'icône récupérée
      appIconImg.className = "appicon";

      const appCellMetaDiv = document.createElement("div");
      appCellMetaDiv.className = "app_cell_meta";

      const appNameDiv = document.createElement("div");
      appNameDiv.className = "appname";
      appNameDiv.textContent = appInfo.name;

      const appSectionDiv = document.createElement("div");
      appSectionDiv.className = "appsection";
      appSectionDiv.textContent = appInfo.category;

      const appGetDiv = document.createElement("div");
      appGetDiv.className = "appget";

      const appLink = document.createElement("a");
      appLink.href = `appinfos.html?name=${appInfo.name}`;

      const getButton = document.createElement("button");
      getButton.className = "getbtn";
      getButton.textContent = "GET";

      // Ajoutez les éléments au DOM
      appCellMetaDiv.appendChild(appNameDiv);
      appCellMetaDiv.appendChild(appSectionDiv);

      appCellLeftDiv.appendChild(appIconImg);
      appCellLeftDiv.appendChild(appCellMetaDiv);

      appLink.appendChild(getButton);
      appGetDiv.appendChild(appLink);

      dockDiv.appendChild(appCellLeftDiv);
      dockDiv.appendChild(appGetDiv);

      dockContainer.appendChild(dockDiv);
    });
  } catch (error) {
    console.error("Error fetching app information:", error.message);
  }
}

// Appel de la fonction pour traiter les applications récentes
processRecentApps();
</script>




</body>

</html>
