<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="css/featured.css" keep>
  <link rel="stylesheet" href="css/navbar.css" keep>
  <link rel="stylesheet" href="css/styles.css" keep>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#121212">
  <meta name="viewport"content="initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>For You | iTweakHub</title>
  <script src="/js/index.js"></script>
  <script src="https://kit.fontawesome.com/a5ae6c00ff.js" crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
</head>

<body style="opacity: 0;">

                                                                              
<div class="sidebar">
  <a href="index.html">Home</a>
  <a class="active" href="appsmanager.html">Apps Manager</a>
  <a href="search.html">Search</a>
</div>

  <div class="content">

    <div class="toptitle">	
    <a style="text-decoration: none" href="appsmanager.html"><h1 style="font-family:helvetica;font-size:21px;margin-left: 16px;color: var(--accent-color);"><i class="fa-solid fa-angle-left" style="color: var(--accent-color);margin-right: 5px;"></i>Back</h1></a>
    <h1 id="repoName" style="font-family:helvetica;font-size:28px;color: #fff;margin-top: 0px;margin-left: 16px;margin-bottom: 10px;">For You</h1>
    </div>
    
<div id="appDockContainer">
  <!-- App Dock will be appended here dynamically -->
</div>
	  
<div class="gradient-div"></div>
  <div class="hidecolor">	
  <input type="color" id="color-picker">
  <button id="reset-button">Reset</button>
	</div> 
   </div>
  

<script>
    // Fonction pour enregistrer la couleur dans localStorage
    function setAccentColor(color) {
      localStorage.setItem('accentColor', color);
    }

    // Fonction pour récupérer la couleur de localStorage
    function getAccentColor() {
      return localStorage.getItem('accentColor');
    }

    // Fonction pour appliquer la couleur à l'élément souhaité
    function applyAccentColor() {
      const accentColor = getAccentColor() || '#7163FF'; // Couleur de base si aucun enregistrement trouvé
      document.documentElement.style.setProperty('--accent-color', accentColor);
    }

    // Réinitialiser la couleur à celle par défaut
    function resetAccentColor() {
      setAccentColor('#7163FF'); // Couleur de base
      applyAccentColor();
    }

    // Écouteur d'événement pour le changement de couleur
    const colorPicker = document.getElementById('color-picker');
    colorPicker.addEventListener('change', function() {
      const color = this.value;
      setAccentColor(color);
      applyAccentColor();
    });

    // Écouteur d'événement pour le bouton de réinitialisation
    const resetButton = document.getElementById('reset-button');
    resetButton.addEventListener('click', function() {
      resetAccentColor();
    });

    // Appliquer la couleur lors du chargement de la page
    applyAccentColor();
  </script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Charger le contenu de foryou.json de manière asynchrone
  fetch("foryou.json")
    .then(response => {
      if (!response.ok) {
        throw new Error(`Failed to fetch foryou.json: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log("foryou.json loaded successfully:", data);
      categories = data.categories; // Assurez-vous que le contenu est attribué à la variable globale
      processRecentApps();
    })
    .catch(error => {
      console.error(`Error fetching foryou.json: ${error.message}`);
    });

  function processRecentApps() {
    const recentApps = JSON.parse(localStorage.getItem("recent")) || [];

    recentApps.forEach(appName => {
      const category = getCategoryForApp(appName);

      if (category) {
        const appsInCategory = category.apps.filter(app => app !== appName);
        const selectedApps = getRandomApps(appsInCategory, 4);

        selectedApps.forEach(selectedAppName => {
          // Utilisez une requête asynchrone pour récupérer les informations de l'application
          getAppInfo(selectedAppName).then(appInfo => {
            if (appInfo) {
              const appDock = createAppDock(appInfo);
              document.getElementById("appDockContainer").appendChild(appDock);
            }
          });
        });
      }
    });
  }

  function getCategoryForApp(appName) {
    return categories.find(category => category.apps.includes(appName));
  }

  function getRandomApps(apps, count) {
    const shuffledApps = apps.sort(() => 0.5 - Math.random());
    return shuffledApps.slice(0, count);
  }

  async function getAppInfo(appName) {
    // Placeholder - à remplacer par la logique réelle de requête JSON
    const repoURLs = JSON.parse(localStorage.getItem("repoURLs")) || [];

    // Essayer de récupérer les infos de l'app depuis les repoURLs
    for (const repoURL of repoURLs) {
      try {
        const response = await fetch(`${repoURL}/${appName}.json`);
        if (response.ok) {
          const appInfo = await response.json();
          return appInfo;
        }
      } catch (error) {
        console.error(`Error fetching app info from ${repoURL}: ${error.message}`);
      }
    }

    // Si les infos n'ont pas été trouvées dans les repoURLs, recherchez dans le fichier apps.json
    try {
      const response = await fetch("apps.json");
      if (response.ok) {
        const allApps = await response.json();
        const appInfo = allApps.apps.find(app => app.name === appName);
        return appInfo;
      }
    } catch (error) {
      console.error(`Error fetching app info from apps.json: ${error.message}`);
    }

    return null;
  }

  function createAppDock(appInfo) {
    const appDock = document.createElement("div");
    appDock.className = "dock";
    appDock.style.margin = "5px";

    appDock.innerHTML = `
      <div class="app_cell_left">
        <img src="${appInfo.iconURL}" class="appicon">
        <div class="app_cell_meta">
          <div class="appname">${appInfo.name}</div>
          <div class="appsection">${appInfo.developerName}</div>
        </div>
      </div>
      <div class="appget">
        <a href="appinfos.html?name=${appInfo.name}">
          <button class="getbtn" id="getbtn">GET</button>
        </a>
      </div>
    `;

    return appDock;
  }
});

let categories;
</script>




</body>

</html>
